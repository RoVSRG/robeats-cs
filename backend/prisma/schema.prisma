generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "windows"]
  engineType    = "binary"
}

datasource db {
  provider = "postgresql"
}

model Player {
  id         BigInt    @id @default(autoincrement())
  user_id    BigInt    @unique
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  rating     Float     @default(0)
  accuracy   Float     @default(0)
  play_count Int       @default(0)
  xp         Int       @default(0)
  name       String
  allowed    Boolean   @default(true)
  scores     Score[]

  @@index([allowed])
  @@map("players")
}

model Score {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  player_id  BigInt?
  hash       String
  score      Int       @default(0)
  accuracy   Float     @default(100)
  max_combo  Int       @default(0)
  marvelous  Int       @default(0)
  perfect    Int       @default(0)
  great      Int       @default(0)
  good       Int       @default(0)
  bad        Int       @default(0)
  miss       Int       @default(0)
  grade      String    @default("F")
  rating     Float     @default(0)
  mean       Float     @default(0)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  rate       Int       @default(100)
  player     Player?   @relation(fields: [player_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([hash])
  @@index([player_id])
  @@index([hash, player_id, rating(sort: Desc), score(sort: Desc)])
  @@index([player_id, hash, rating(sort: Desc), score(sort: Desc)])
  @@index([player_id, hash, created_at(sort: Desc)])
  @@map("scores")
}
