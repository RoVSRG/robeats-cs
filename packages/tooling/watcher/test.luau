--!strict
-- Basic validation tests for the refactored watcher modules

local Paths = require("./paths")
local Encoding = require("./encoding") 
local Watcher = require("./watcher")

-- Test suite
local function runTests()
	print("ğŸ§ª Running basic validation tests...")
	
	-- Test path parsing
	print("\nğŸ“ Testing path parsing:")
	local pathParts = Paths.parseRobloxPath("game.StarterGui.Screens.MainMenu")
	print("âœ… Parsed path parts:", table.concat(pathParts, ", "))
	assert(pathParts[1] == "game", "Expected 'game' as first part")
	assert(pathParts[4] == "MainMenu", "Expected 'MainMenu' as fourth part")
	
	-- Test base path validation
	print("\nğŸ” Testing base path validation:")
	local isValid, error = Paths.validateBasePath("game.StarterGui.Screens.MainMenu")
	assert(isValid, "Valid path should pass validation")
	print("âœ… Valid path validation passed")
	
	local isInvalid, invalidError = Paths.validateBasePath("invalid.path")
	assert(not isInvalid, "Invalid path should fail validation")
	print("âœ… Invalid path validation passed:", invalidError)
	
	-- Test relative path extraction
	print("\nğŸ“‚ Testing relative path extraction:")
	local relativePath, pathError = Paths.extractRelativePath("game.StarterGui.Screens.MainMenu.SubMenu")
	assert(not pathError, "Should not have error for valid path")
	assert(relativePath == "MainMenu/SubMenu", "Relative path should be MainMenu/SubMenu, got: " .. tostring(relativePath))
	print("âœ… Relative path extraction passed:", relativePath)
	
	-- Test filename sanitization
	print("\nğŸ§¹ Testing filename sanitization:")
	local sanitized = Encoding.sanitizeFilename("My<Script>Name")
	assert(sanitized == "My_Script_Name", "Should replace invalid characters with underscores")
	print("âœ… Filename sanitization passed:", sanitized)
	
	-- Test place file detection
	print("\nğŸ” Testing place file detection:")
	local placeFile = Watcher.getPlaceFile()
	if placeFile then
		print("âœ… Found place file:", placeFile)
	else
		print("âš ï¸ No place file found (this might be expected if no .rbxl/.rbxlx files exist)")
	end
	
	print("\nğŸ‰ All basic validation tests completed!")
	return true
end

-- Run the tests
local success, error = pcall(runTests)

if success then
	print("âœ… Test suite completed successfully")
else
	print("âŒ Test suite failed:", error)
	os.exit(1)
end